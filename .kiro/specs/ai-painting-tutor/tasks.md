# AI 絵画指導アプリ 実装タスクリスト

- [ ] 1. プロジェクト基盤とコア型定義の実装

  - Next.js App Router プロジェクトの初期設定と Tailwind CSS、TypeScript 設定
  - Sharp（画像最適化）の依存関係追加とセットアップ
  - コア型定義（Material, DifficultyLevel, AnalysisResult, DrawingStep, TutorialSession）の実装
  - 基本的なディレクトリ構造とファイル配置の作成
  - タイムアウト・エラーハンドリング設定の追加
  - _要件: 1.1, 2.1, 3.1_

- [ ] 2. 画像アップロード機能の実装

  - [ ] 2.1 ImageUpload コンポーネントの作成

    - ファイル選択 UI、プレビュー表示、バリデーション機能を含む React コンポーネント
    - ファイル形式・サイズ制限の実装とエラーメッセージ表示
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ] 2.2 画像アップロード API エンドポイントの実装

    - `/api/upload` エンドポイントの作成とファイル処理ロジック
    - Cloud Storage への一時保存機能とセキュリティ検証
    - _要件: 1.1, 1.5, 10.1, 10.2_

  - [ ] 2.3 useImageUpload カスタムフックの実装
    - アップロード状態管理、エラーハンドリング、進捗表示のロジック
    - リトライ機能と適切なエラーメッセージの実装
    - _要件: 1.1, 8.1, 8.2_

- [ ] 3. 画材選択機能の実装

  - [ ] 3.1 MaterialSelector コンポーネントの作成

    - デッサン、水彩画、色鉛筆、アクリル絵の具の選択 UI
    - 選択状態の視覚的フィードバックと次ステップボタンの制御
    - _要件: 2.1, 2.2, 2.3_

  - [ ] 3.2 画材選択状態管理の実装
    - Zustand を使用した画材選択状態の管理
    - 選択データの永続化とセッション管理
    - _要件: 2.1, 2.4_

- [ ] 4. AI 画像解析・難易度判定機能の実装

  - [ ] 4.1 Gemini API 統合サービスの実装

    - Gemini API クライアントの設定と画像解析リクエスト処理
    - 20 秒タイムアウト設定とリトライ機能の実装
    - 画像サイズ事前チェック（最大 800x600 にリサイズ）
    - API レスポンスの型安全な処理とエラーハンドリング
    - _要件: 3.1, 3.2, 8.1_

  - [ ] 4.2 `/api/analysis` エンドポイントの実装

    - 画像の事前最適化（800x600 以下にリサイズ、品質調整）
    - 20 秒タイムアウトでの画像解析処理
    - 失敗時のフォールバック（デフォルト難易度設定）
    - 難易度判定ロジックと結果の構造化
    - _要件: 3.1, 3.2, 3.5, 9.2_

  - [ ] 4.3 DifficultyDisplay コンポーネントの実装

    - 解析結果の表示 UI（難易度、理由、推定時間）
    - 「手順を表示する」「他の絵を選ぶ」ボタンの実装
    - _要件: 3.3, 3.4_

  - [ ] 4.4 useAnalysis カスタムフックの実装
    - 解析処理の状態管理とローディング表示
    - エラー処理とリトライ機能の実装
    - _要件: 3.1, 3.5, 8.1, 8.4_

- [ ] 5. 段階的手順生成機能の実装

  - [ ] 5.1 手順生成 API エンドポイントの実装

    - `/api/generate-steps` エンドポイントで画材別手順生成ロジック
    - Gemini API を使用した段階別描画手順の生成
    - _要件: 4.1, 4.2, 4.3, 4.4_

  - [ ] 5.2 画材別手順テンプレートの実装

    - デッサン、水彩画、色鉛筆、アクリル絵の具それぞれの手順構造
    - 各画材に特化した指導内容とコツの生成
    - _要件: 4.3, 4.4_

  - [ ] 5.3 手順データ検証とフォーマット処理
    - 生成された手順データの妥当性検証
    - フロントエンド表示用のデータ構造への変換
    - _要件: 4.2, 4.5_

- [ ] 6. AI 画像生成機能の実装（Gemini 2.5 Flash Image）

  - [ ] 6.1 GeminiImageService の実装

    - `src/services/gemini-image.ts` に Gemini 2.5 Flash Image 統合サービス作成
    - 4 種類の画像生成メソッド（線画、ベタ塗り、ハイライト、色塗り見本）
    - 画材別プロンプト生成と textureStrength 反映
    - 30 秒タイムアウト設定とエラーハンドリング
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 6.2 型定義の拡張

    - `src/types/image-generation.ts` に新しい型定義を追加
    - GeneratedImages、ImageGenerationRequest、ImageGenerationResponse
    - 既存の Material 型との統合
    - _要件: 6.5, 6.6_

  - [ ] 6.3 `/api/generate-images` エンドポイントの拡張
    - 既存 API ルートに Gemini 2.5 Flash Image 機能を統合
    - 並列画像生成とフォールバック処理
    - 既存のエラーハンドリングパターンを継承
    - _要件: 6.7, 6.8_

- [ ] 7. 参考画像表示機能の実装

  - [ ] 7.1 MaterialSelector コンポーネントの拡張

    - textureStrength 入力フィールドを既存デザインに合わせて追加
    - 既存の画材選択 UI との統合
    - _要件: 6.6_

  - [ ] 7.2 画像表示コンポーネントの実装

    - 生成された 4 種類の画像を適切に表示
    - ローディング状態とエラー状態の表示
    - 既存の StepGuide コンポーネントとの統合
    - _要件: 7.1, 7.2, 7.3_

  - [ ] 7.3 画像処理ユーティリティの実装
    - Sharp による画像リサイズ、圧縮、形式変換の共通処理
    - 画像メタデータ除去とセキュリティ対策
    - メモリ効率的な画像処理とエラーハンドリング
    <!-- 将来の拡張: RGB→Lab変換、K-means、XDoG、Cannyエッジ検出等 -->
    - _要件: 6.5, 9.3, 8.3_

- [ ] 7. ステップバイステップ指導画面の実装

  - [ ] 7.1 StepGuide コンポーネントの実装

    - 現在ステップの表示と参考画像・テキスト指示の表示
    - ナビゲーションボタン（次へ・戻る）の実装
    - _要件: 5.1, 5.2, 5.3, 5.4_

  - [ ] 7.2 ProgressBar コンポーネントの実装

    - 全体進捗の視覚的表示とステップ番号の管理
    - 完了ステップのマーキングと進捗パーセンテージ
    - _要件: 5.1, 5.6_

  - [ ] 7.3 useTutorial カスタムフックの実装

    - チュートリアル進行状態の管理とステップ遷移ロジック
    - 最初・最後のステップでのボタン制御
    - _要件: 5.3, 5.4, 5.5, 5.6_

  - [ ] 7.4 チュートリアル画面レイアウトの実装
    - デスクトップ最適化されたレスポンシブレイアウト
    - 参考画像とテキストの効果的な配置
    - _要件: 7.1, 7.2_

- [ ] 8. エラーハンドリングとユーザビリティの実装

  - [ ] 8.1 ErrorBoundary コンポーネントの実装

    - React Error Boundary による包括的エラーキャッチ
    - ユーザーフレンドリーなエラー画面の表示
    - _要件: 8.1, 8.3_

  - [ ] 8.2 グローバルエラーハンドリングの実装

    - API エラー、ネットワークエラーの統一的処理
    - エラータイプ別のリトライ戦略とユーザーメッセージ
    - _要件: 8.1, 8.2, 8.5_

  - [ ] 8.3 ローディング状態とプログレスインジケーターの実装
    - 長時間処理中の進捗表示と推定残り時間
    - ユーザー操作の中断確認ダイアログ
    - _要件: 8.4, 8.5_

- [ ] 9. パフォーマンス最適化の実装

  - [ ] 9.1 画像最適化とキャッシュ戦略の実装

    - Next.js Image コンポーネントの活用と WebP 変換
    - SWR による API レスポンスキャッシュの実装
    - _要件: 9.1, 9.2, 9.3, 9.4_

  - [ ] 9.2 コード分割と遅延読み込みの実装

    - ページレベルでの動的インポートと重いライブラリの最適化
    - 画像の遅延読み込みとプリロード戦略
    - _要件: 9.4, 9.5_

  - [ ] 9.3 API レスポンス最適化の実装
    - レスポンス圧縮とデータサイズ最小化
    - 適切な HTTP ステータスコードとキャッシュヘッダー
    - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 10. セキュリティとプライバシー保護の実装

  - [ ] 10.1 データ保護機能の実装

    - HTTPS 通信の強制とセキュアヘッダーの設定
    - 画像メタデータ除去と一時ファイル自動削除
    - _要件: 10.1, 10.2, 10.3_

  - [ ] 10.2 入力値検証とレート制限の実装

    - アップロードファイルの厳密な検証とサニタイゼーション
    - API レート制限と DDoS 攻撃対策
    - _要件: 10.4, 8.1_

  - [ ] 10.3 プライバシー保護機能の実装
    - ユーザーデータの暗号化と適切な保存期間管理
    - 利用規約とプライバシーポリシーの実装
    - _要件: 10.3, 10.4, 10.5_

- [ ] 11. テスト実装

  - [ ] 11.1 ユニットテストの実装

    - 全コンポーネントとカスタムフックのテスト
    - ユーティリティ関数と API 関数のテスト
    - _要件: 全要件のテストカバレッジ_

  - [ ] 11.2 統合テストの実装

    - API Routes とコンポーネント間連携のテスト
    - 外部サービス統合テスト（モック使用）
    - _要件: 1.1-10.5 の統合動作確認_

  - [ ] 11.3 E2E テストの実装
    - Playwright を使用した主要ユーザーフローのテスト
    - エラーケースとエッジケースの動作確認
    - _要件: 1.1-10.5 のエンドツーエンド確認_

- [ ] 12. カラーパレット・色混合解説機能の実装

  - [ ] 12.1 ColorPaletteService の実装

    - `src/services/color-palette.ts` にカラーパレット抽出サービス作成
    - K-means クラスタリングによる主要色抽出アルゴリズム
    - RGB/HSV 変換、色名判定、混色レシピ生成機能
    - 画材別混色アドバイス生成機能
    - _要件: 11.1, 11.2, 11.3_

  - [ ] 12.2 カラーパレット型定義の実装

    - `src/types/color-palette.ts` に色関連の型定義を追加
    - RGB、HSV、ColorAnalysis、ColorPalette、MixingRecipe 型
    - 既存の Material 型との統合
    - _要件: 11.2, 11.4_

  - [ ] 12.3 `/api/color-palette` エンドポイントの実装

    - カラーパレット生成 API の作成
    - 画像解析とフォールバック処理
    - 既存のエラーハンドリングパターンを継承
    - _要件: 11.1, 11.7_

  - [ ] 12.4 ColorPalette コンポーネントの実装

    - カラーパレット表示 UI（4x2 グリッド形式）
    - 色見本クリック時の詳細表示
    - 既存デザインシステムとの統合
    - _要件: 11.2, 11.3_

  - [ ] 12.5 ColorDetails コンポーネントの実装

    - 選択色の詳細情報表示（RGB、HSV、HEX 値）
    - 混色レシピの段階的表示
    - 画材別混色アドバイスの表示
    - _要件: 11.4, 11.5, 11.6_

  - [ ] 12.6 既存 UI との統合

    - StepGuide コンポーネントにカラーパレット機能を統合
    - 色塗りステップでのカラーパレット自動表示
    - レスポンシブデザイン対応
    - _要件: 11.1, 11.2_

- [ ] 13. デプロイメントと本番環境設定

  - [ ] 13.1 Google Cloud 環境設定

    - Cloud Run（Next.js アプリ統合）、Cloud Storage の設定
    - Node.js/TypeScript 統一環境でのデプロイ設定
    - 環境変数とシークレット管理の実装
    - _要件: 9.5, 10.1_

  - [ ] 13.2 CI/CD パイプラインの実装

    - GitHub Actions による自動テスト・ビルド・デプロイ
    - 本番環境とステージング環境の分離
    - _要件: 全要件の本番環境動作確認_

  - [ ] 13.3 監視とログ設定の実装
    - アプリケーション監視とエラートラッキング
    - パフォーマンス監視とアラート設定
    - _要件: 9.1-9.5, 8.1-8.5_
