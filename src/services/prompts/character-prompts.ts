/**
 * 人物・キャラクター画専用プロンプト
 */

// stepTypeベースの新しいプロンプト関数
export function generateCharacterPromptByType(
  stepType: string,
  stepDescription: string
): string {
  switch (stepType) {
    case "background":
      return generateBackgroundPrompt(stepDescription);
    case "skin":
      return generateSkinPrompt(stepDescription);
    case "clothing":
      return generateClothingPrompt(stepDescription);
    case "hair":
      return generateHairPrompt(stepDescription);
    case "accessories":
      return generateAccessoriesPrompt(stepDescription);
    case "main_part":
      return generateMainPartPrompt(stepDescription);
    case "details":
      return generateDetailsPrompt(stepDescription);
    default:
      return generateGenericCharacterPrompt(stepDescription);
  }
}

// 各stepType専用のプロンプト関数
function generateBackgroundPrompt(stepDescription: string): string {
  return `**【緊急重要】背景のみを塗り、キャラクター部分は絶対に塗らないでください！！！**

【作業内容】
${stepDescription}

**【背景のみ塗る厳格なルール - 最重要】**
1. **キャラクターの輪郭線を境界として認識する**
2. **輪郭線の外側（背景）のみを塗る**
3. **輪郭線の内側（キャラクター）は絶対に塗らない**
4. **黒い輪郭線は一切変更・塗りつぶししない**

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの（背景のみ）**：
  - キャラクターの輪郭線の外側の領域
  - 背景の空間・壁・床
  - キャラクターの周囲の環境
- ❌ **絶対に塗らないもの（キャラクター）**：
  - 顔・頭・髪の部分
  - 体・手・足の部分
  - 服・衣装の部分
  - キャラクターの全ての内部領域

**【境界線の厳格な遵守】**
1. キャラクターの黒い輪郭線を絶対に越えない
2. 輪郭線に色がかからないよう細心の注意を払う
3. 輪郭線の内側は完全に白いまま保持
4. 背景色とキャラクター領域の間に明確な境界を維持

**重要：キャラクターの輪郭線を境界として、外側（背景）のみを塗り、内側（キャラクター）は白黒線画のまま完全に保持してください。この段階ではキャラクターへの色塗りは絶対に行いません。**

アクリル絵の具の質感で背景を塗ってください。`;
}

function generateSkinPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、顔・手・肌の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の肌・顔のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【肌・顔のみ塗るルール】**
- **元画像の肌色を詳細に観察し、同じ色で顔・手・肌の部分のみを塗る**
- **髪・服・小物は絶対に塗らない**：白いまま残す
- **背景も白いまま残す**

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの**：
  - 顔の肌色部分
  - 手・腕・足の肌色部分
  - 首の肌色部分
- ❌ **絶対に塗らないもの**：
  - 髪の部分（白いまま残す）
  - 服・衣装（白いまま残す）
  - 小物・アクセサリー（白いまま残す）
  - 背景（白いまま残す）

**重要：肌色部分のみを塗り、髪・服・小物は次のステップまで白いまま残してください。**`;
}

function generateClothingPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、服・衣装の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の服・衣装のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【服・衣装のみ塗るルール】**
- **元画像の服の色を1ピクセル単位で詳細に観察し、完全に同じ色で服・衣装・靴の部分のみを塗る**
- **色の判断を間違えない**：黒い服は黒で、青い服は青で、白い服は白で正確に再現
- **髪・小物は絶対に塗らない**：白いまま残す
- **肌・背景も白いまま残す**

**【服の色の正確な観察方法 - 最重要】**
1. **服の実際の色を正確に特定する**：
   - 黒い服・制服 → 黒色（#000000系）で塗る
   - 紺色の服 → 濃い青色（#000080系）で塗る
   - 青い服 → 青色（#0000FF系）で塗る
   - 白い服・シャツ → 白色（#FFFFFF系）で塗る

**重要：服・衣装の色のみを正確に塗り、髪・小物は次のステップまで白いまま残してください。**`;
}

function generateHairPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、髪の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の髪のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【髪のみ塗るルール】**
- **元画像の髪色を詳細に観察し、同じ色で髪の部分のみを塗る**
- **小物・アクセサリーは絶対に塗らない**：白いまま残す
- **肌・服・背景も白いまま残す**

**重要：髪の色のみを塗り、小物・アクセサリーは次のステップまで白いまま残してください。**`;
}

function generateAccessoriesPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、小物・アクセサリーの部分のみを正確な色で塗ってください**

この作業は「キャラクター画の小物・アクセサリーのみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【小物・アクセサリーのみ塗るルール】**
- **元画像の小物・アクセサリーの色を詳細に観察し、同じ色で塗る**
- **肌・髪・服・背景は絶対に塗らない**：現在の状態のまま保持

**重要：小物・アクセサリーの色のみを塗り、他の部分は現在の状態のまま保持してください。**`;
}

function generateMainPartPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、肌・服・衣装の部分のみを正確な色で塗ってください**
アクリル絵の具の質感で書いてください。

この作業は「キャラクター画の肌・服・衣装の複合描写」の工程です：

【実行する手順】
"${stepDescription}"

**【主要部分の複合塗り - 背景も含む】**
- **背景の部分**：元画像の背景色を詳細に観察し、完全に同じ色で塗る
- **肌の部分**：元画像の肌色を1ピクセル単位で観察し、完全に同じ色で塗る
- **服・衣装の部分**：元画像の服の色を観察し、完全に同じ色で服・衣装・靴の部分を塗る
- **髪の部分**：元画像の髪色を観察し、完全に同じ色で塗る
- **小物・アクセサリー**：元画像の色を観察し、同じ色で塗る

**重要：背景・肌・服・髪・小物など主要な全ての部分を元画像と同じ色で正確に塗ってください。**`;
}

function generateDetailsPrompt(stepDescription: string): string {
  return `**【超重要】元画像を参照して、細部・仕上げを正確に行ってください**
アクリル絵の具の質感で書いてください。

この作業は「キャラクター画の細部・仕上げ」の工程です：

【実行する手順】
"${stepDescription}"

**【細部・仕上げのルール】**
- **目・口・眉毛などの細部をブラックで描き込む**
- **ハイライトを白で加える**
- **全体のバランスを調整する**
- **元画像の特徴を正確に再現する**

**重要：細部の仕上げを丁寧に行い、元画像の特徴を正確に再現してください。**`;
}

function generateGenericCharacterPrompt(stepDescription: string): string {
  return `**【重要】元画像を参照して、指定された部分を正確な色で塗ってください**

【実行する手順】
"${stepDescription}"

**【基本ルール】**
- **元画像の色を正確に観察し、同じ色で塗る**
- **指定されていない部分は塗らない**
- **全体のバランスを保つ**

**重要：元画像の色を正確に再現してください。**`;
}
export function generateCharacterPrompt(stepDescription: string): string {
  // 背景塗り
  if (stepDescription.includes("背景") || stepDescription.includes("輪郭外")) {
    return `**【緊急重要】背景のみを塗り、キャラクター部分は絶対に塗らないでください！！！**

🚨 **絶対禁止**: キャラクター（人物・動物）部分への色塗り
✅ **実行すること**: 背景領域のみの色塗り

【作業内容】
${stepDescription}

**【背景のみ塗る厳格なルール - 最重要】**
1. **キャラクターの輪郭線を境界として認識する**
2. **輪郭線の外側（背景）のみを塗る**
3. **輪郭線の内側（キャラクター）は絶対に塗らない**
4. **黒い輪郭線は一切変更・塗りつぶししない**

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの（背景のみ）**：
  - キャラクターの輪郭線の外側の領域
  - 背景の空間・壁・床
  - キャラクターの周囲の環境
- ❌ **絶対に塗らないもの（キャラクター）**：
  - 顔・頭・髪の部分
  - 体・手・足の部分
  - 服・衣装の部分
  - キャラクターの全ての内部領域

**【背景色の指定 - 最重要】**
- ステップ説明に色名が含まれている場合、その色で背景を塗る
- 色名が明確でない場合は、元画像の背景色を観察して同じ色で塗る
- 背景は必ず何らかの色で塗る（白いまま残さない）

**【境界線の厳格な遵守】**
1. キャラクターの黒い輪郭線を絶対に越えない
2. 輪郭線に色がかからないよう細心の注意を払う
3. 輪郭線の内側は完全に白いまま保持
4. 背景色とキャラクター領域の間に明確な境界を維持

**【最終確認チェック】**
- キャラクターの顔・体・服に色が塗られていないか？
- 黒い輪郭線が保持されているか？
- 背景のみが塗られているか？

**重要：キャラクターの輪郭線を境界として、外側（背景）のみを塗り、内側（キャラクター）は白黒線画のまま完全に保持してください。この段階ではキャラクターへの色塗りは絶対に行いません。**`;
  }

  // 主要部分塗り（肌・服・衣装の描写）
  else if (
    stepDescription.includes("主要部分") ||
    stepDescription.includes("メイン") ||
    stepDescription.includes("メインとなる部分") ||
    stepDescription.includes("肌・服") ||
    stepDescription.includes("肌・衣装") ||
    (stepDescription.includes("肌") && stepDescription.includes("服")) ||
    (stepDescription.includes("肌") && stepDescription.includes("衣装")) ||
    stepDescription.includes("描写") ||
    stepDescription.includes("実際の色で塗る")
  ) {
    return `**【超重要】元画像を参照して、肌・服・衣装の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の肌・服・衣装の複合描写」の工程です：

【実行する手順】
"${stepDescription}"

**【肌・服・衣装のみ塗るルール】**
- **元画像の服の色を観察し、完全に同じ色で服・衣装・靴の部分を塗る**
- **色の判断を間違えない**：黒い服は黒で、青い服は青で、白い服は白で正確に再現
- **髪・小物は絶対に塗らない**：白いまま残す
- **背景は絶対に塗らない**：白いまま残す

**【色の正確な観察方法 - 最重要】**
1. **服の色を正確に特定する**：
   - 黒い服 → 黒色（#000000系）で塗る
   - 青い服 → 青色（#0000FF系）で塗る
   - 白い服 → 白色（#FFFFFF系）で塗る
   - グレーの服 → グレー色（#808080系）で塗る
2. **肌色を正確に特定する**：
   - 薄い肌色 → ライトベージュ系で塗る
   - 濃い肌色 → ダークベージュ系で塗る
3. **元画像の色を一切変更・推測しない**：
   - 見た通りの色をそのまま再現
   - 勝手な色の解釈や変更は絶対禁止

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの**：
  - 顔・手・腕・足の肌色部分
  - 服・衣装・靴・靴下の部分
  - 衣装の装飾部分
- ❌ **絶対に塗らないもの**：
  - 髪の部分（次のステップで塗る）
  - 小物・アクセサリー（次のステップで塗る）
  - 背景（白いまま残す）
  - 目・口・眉毛（白いまま残す）

**重要：元画像の服の色を正確に観察し、黒い服なら黒で、青い服なら青で、完全に同じ色で塗ってください。肌と服の部分のみを塗り、髪・小物・背景は絶対に塗らず白いまま残してください。**`;
  }

  // 肌・顔のみ塗り
  else if (stepDescription.includes("肌") || stepDescription.includes("顔")) {
    return `**【超重要】元画像を参照して、顔・手・肌の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の肌・顔のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【肌・顔のみ塗るルール】**
- **元画像の肌色を詳細に観察し、同じ色で顔・手・肌の部分のみを塗る**
- **髪・服・小物は絶対に塗らない**：白いまま残す
- **背景も白いまま残す**

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの**：
  - 顔の肌色部分
  - 手・腕・足の肌色部分
  - 首の肌色部分
- ❌ **絶対に塗らないもの**：
  - 髪の部分（白いまま残す）
  - 服・衣装（白いまま残す）
  - 小物・アクセサリー（白いまま残す）
  - 背景（白いまま残す）

**重要：肌色部分のみを塗り、髪・服・小物は次のステップまで白いまま残してください。**`;
  }

  // 服・衣装塗り
  else if (stepDescription.includes("服") || stepDescription.includes("衣装")) {
    return `**【超重要】元画像を参照して、服・衣装の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の服・衣装のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【服・衣装のみ塗るルール】**
- **元画像の服の色を1ピクセル単位で詳細に観察し、完全に同じ色で服・衣装・靴の部分のみを塗る**
- **色の判断を間違えない**：黒い服は黒で、青い服は青で、白い服は白で正確に再現
- **髪・小物は絶対に塗らない**：白いまま残す
- **肌・背景も白いまま残す**

**【服の色の正確な観察方法 - 最重要】**
1. **服の実際の色を正確に特定する**：
   - 黒い服・制服 → 黒色（#000000系）で塗る
   - 紺色の服 → 濃い青色（#000080系）で塗る
   - 青い服 → 青色（#0000FF系）で塗る
   - 白い服・シャツ → 白色（#FFFFFF系）で塗る
   - グレーの服 → グレー色（#808080系）で塗る
2. **元画像の色を一切変更・推測しない**：
   - 見た通りの色をそのまま再現
   - 勝手な色の解釈や変更は絶対禁止
   - 黒い服を青と間違えない

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの**：
  - 服・衣装の部分
  - 靴・靴下の部分
  - 衣装の装飾部分
- ❌ **絶対に塗らないもの**：
  - 髪の部分（次のステップで塗る）
  - 小物・アクセサリー（次のステップで塗る）
  - 肌・背景（白いまま残す）

**【最終確認チェック】**
- 服の色が元画像と完全に一致しているか？（黒い服は黒、青い服は青で塗られているか？）
- 黒い服を青と間違えて塗っていないか？
- 髪・小物・肌・背景が白いまま残されているか？
- 勝手な色の変更や推測をしていないか？

**重要：元画像の服の色を正確に観察し、黒い服なら黒で、青い服なら青で、完全に同じ色で塗ってください。服・衣装部分のみを塗り、髪・小物は次のステップまで白いまま残してください。**`;
  }

  // 髪・小物塗り
  else if (
    stepDescription.includes("髪") ||
    stepDescription.includes("小物") ||
    stepDescription.includes("装飾")
  ) {
    return `**【超重要】元画像を参照して、髪・小物・装飾の部分のみを正確な色で塗ってください**

この作業は「キャラクター画の髪・小物・装飾のみ塗り」の工程です：

【実行する手順】
"${stepDescription}"

**【髪・小物のみ塗るルール】**
- **髪・小物・装飾の部分のみを塗る**
- **肌・服・背景は白いまま残す**

**【具体的な塗り分け指示】**
- ✅ **塗ってよいもの**：
  - 髪の部分
  - アクセサリー・装飾品
  - 小物・持ち物
- ❌ **絶対に塗らないもの**：
  - 肌・服・背景（白いまま残す）

**重要：髪・小物・装飾部分のみを塗り、既に完成した部分は保持してください。**`;
  }

  // 仕上げ・細部
  else if (
    stepDescription.includes("仕上げ") ||
    stepDescription.includes("細部") ||
    stepDescription.includes("詳細") ||
    stepDescription.includes("完成")
  ) {
    return `**【超重要】最小限の細部描き込みのみを行い、既存の色は絶対に変更しないでください**

この作業は「キャラクター画の仕上げ・細部描き込み」の工程です：

【実行する手順】
"${stepDescription}"

**【仕上げの厳格なルール】**
1. **既存の色を保持**：前ステップまでの色は一切変更しない
2. **最小限の追加のみ**：目・口・眉毛があれば、細部のみ描き込む
3. **元画像に忠実**：元画像にある表情・特徴のみ再現
4. **余計な装飾禁止**：創作的な要素は一切追加しない

**重要：仕上げでは目・口・眉毛の細部のみを描き込み、既に塗られた色や背景は絶対に変更せず、余計な装飾も一切追加しないでください。**`;
  }

  // その他のキャラクターステップ（汎用）
  else {
    return `**【最重要】元画像の色を詳細に観察し、100%忠実に再現して段階的に塗り分けてください**

【実行する手順】
"${stepDescription}"

**【キャラクター画の基本ルール】**
1. **元画像の該当部分を1ピクセル単位で詳細に分析する**
2. **観察した色を一切変更せずに正確に再現する**
3. **色の判断を間違えない**：黒は黒、青は青、白は白で正確に再現
4. **このステップで指定された領域のみを塗る**
5. **指定されていない領域は白いまま残す**
6. **線画の黒い輪郭線は絶対に変更しない**

**【色の正確な観察 - 最重要】**
- 黒い服・髪 → 黒色（#000000系）で塗る
- 青い服・目 → 青色（#0000FF系）で塗る
- 白い服・肌 → 白色・ベージュ系で塗る
- 勝手な色の解釈や変更は絶対禁止

**重要：元画像の色を正確に観察し、黒い部分は黒で、青い部分は青で、完全に同じ色でこのステップで指定された範囲のみを塗ってください。**`;
  }
}
